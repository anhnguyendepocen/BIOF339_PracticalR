---
title: "Lecture 10 Practicum Solutions"
output:
  html_document: default
  html_notebook: default
---

1. The ChickWeight data frame (from the datasets package) contains time course data for chicks as their weight increases.  Aggregate (or summarise) this data for all chicks on the same diet, and create a plot of the data suitable for publication (or at least a lab meeting), including standard error bars.  Adjust axis labels and legend to be properly discriptive and save the final plot to a pdf file.  You can use the help page for the ChickWeight data frame to learn about the data set, including units.

```{r eval=TRUE, results='markup'}
library(datasets)
library(tidyverse)
head(ChickWeight)
se <- function(x) sqrt(var(x)/length(x))
feedTimeSummary <- ChickWeight %>% group_by(Time, Diet) %>% summarise(mean = mean(weight), se = se(weight))
ggplot(feedTimeSummary, aes(x=Time, y=mean, color=Diet)) + geom_line() + geom_errorbar(aes(ymin=mean - se, ymax= mean + se))
```

Not bad, but we want to change the axis labels

```{r eval=TRUE, results='markup'}
ggplot(feedTimeSummary, aes(x=Time, y=mean, color=Diet)) + geom_line() + geom_errorbar(aes(ymin=mean - se, ymax= mean + se)) + scale_x_continuous("Time (days since hatching)") + scale_y_continuous("Mean Weight of Chicks (grams)")
```

Good enough for lab meeting.  Now save the graph to a pdf file.

```{r eval=TRUE, results='markup'}
pdf(file="chickweight.pdf", width=6, height=4)
ggplot(feedTimeSummary, aes(x=Time, y=mean, color=Diet)) + geom_line() + geom_errorbar(aes(ymin=mean - se, ymax= mean + se)) + scale_x_continuous("Time (days since hatching)") + scale_y_continuous("Mean Weight of Chicks (grams)")
dev.off()
```

2. Your PI is so pleased with the results, she wants you to submit them as a letter to the "Journal of Arcane Publishing Requirements".  It is an old style print publication that charges extra for color graphs, and so you are told to produce a readable plot in greyscale.  Use facet to break the results into four graphs for the four feed types (avoiding the need for color), and save the results in BMP format at a resolution of 300 ppi, with a maximum width of 8 inches (to fit in the margins).

```{r}
ggplot(feedTimeSummary, aes(x=Time, y=mean)) + geom_line() + geom_errorbar(aes(ymin=mean - se, ymax= mean + se)) + facet_grid(~ Diet) + scale_x_continuous("Time (days since hatching)") + scale_y_continuous("Mean Weight of Chicks (grams)")
bmp(filename = "japr_figure1.bmp", width = 8, height=3, units = "in", res=300)
ggplot(feedTimeSummary, aes(x=Time, y=mean)) + geom_line() + geom_errorbar(aes(ymin=mean - se, ymax= mean + se)) + facet_grid(~ Diet) + scale_x_continuous("Time (days since hatching)") + scale_y_continuous("Mean Weight of Chicks (grams)")
dev.off()
```

3. Your paper is almost ready to submit and you are working on the references.  How do you know whom or what to cite for the graphs you made in R (hint: there is a function called citation)?

```{r}
citation()
citation("ggplot2")
citation("tidyverse")
```

4. Your paper is rejected because your chick weight research did not include any references to the microbiome or CRISPR.  Your PI decides that the work can be fit into a larger paper your lab is submitting to Nature.  You can use color again, but now your graph needs to fit into an area of 2 inches by 2 inches, still be readable, and should be a PDF so you can edit font type and size later.  For bonus points, take the PDF you generate into Adobe Illustrator or Inkscape and edit the font type and size to the Nature requirements (12-point Times New Roman)

```{r eval=TRUE, results='markup'}
pdf(file="chickweightv2.pdf", width=2, height=2)
ggplot(feedTimeSummary, aes(x=Time, y=mean, color=Diet)) + geom_line() + geom_errorbar(aes(ymin=mean - se, ymax= mean + se)) + scale_x_continuous("Time (days since hatching)") + scale_y_continuous("Mean Weight of Chicks (grams)")
dev.off()
```

While not terrible, the axis labels are too long and the legend takes up too much space.  Try adjusting the axis font size and moving the legend to the top of the graph.

<img src="chickweightv2.pdf" alt="First Attempt"  width="200" height="200">

```{r}
pdf(file="chickweightv3.pdf", width=2, height=2)
ggplot(feedTimeSummary, aes(x=Time, y=mean, color=Diet)) + geom_line() + geom_errorbar(aes(ymin=mean - se, ymax= mean + se)) + scale_x_continuous("Time (days)") + scale_y_continuous("Mean Weight (grams)") +
  theme(legend.position="top") + theme(text = element_text(size=8))
dev.off()
```

<img src="chickweightv3.pdf" alt="Second Attempt"  width="200" height="200">

Not bad but the legend is still taking up a lot of room.  Because there is a lot of empty space in the graph, try locating the legend IN the graph.

```{r}
pdf(file="chickweightv4.pdf", width=2, height=2)
ggplot(feedTimeSummary, aes(x=Time, y=mean, color=Diet)) + geom_line() + geom_errorbar(aes(ymin=mean - se, ymax= mean + se)) + scale_x_continuous("Time (days)") + scale_y_continuous("Mean Weight (grams)") +
  theme(legend.justification=c(0,1), legend.position=c(0,1)) + theme(text = element_text(size=8))
dev.off()
```

<img src="chickweightv4.pdf" alt="Third Attempt"  width="200" height="200">

Very close, but now our legend obscures some data points.  Let's see if we can shrink the legend height and move it a tad to the right and down.

```{r}
pdf(file="chickweightv5.pdf", width=2, height=2)
ggplot(feedTimeSummary, aes(x=Time, y=mean, color=Diet)) + geom_line() + geom_errorbar(aes(ymin=mean - se, ymax= mean + se)) + scale_x_continuous("Time (days)") + scale_y_continuous("Mean Weight (grams)") +
  theme(legend.justification=c(0,0.9), legend.position=c(0.1,0.9)) +
  theme(text = element_text(size=8)) +
  theme(legend.key.height = unit(0.3, "cm"))
dev.off()
```

<img src="chickweightv5.pdf" alt="Third Attempt"  width="200" height="200">